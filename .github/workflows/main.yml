name: ğŸš€ Deploy on push to master

on:
    push:
        branches:
            - master
    pull_request:
        branches:
            - master

jobs:
    deploy:
        name: ğŸ‰ Deploy
        runs-on: ubuntu-latest

        steps:
            - name: ğŸšš Get latest code
              uses: actions/checkout@v4

            - name: Set up Node
              uses: actions/setup-node@v4
              with:
                  node-version: "20"
                  cache: "npm"

            #   - name: ğŸ“ Set environment variables
            #     run: echo "REACT_APP_API_URL=${{ secrets.REACT_APP_API_URL }}" >> .env

            - name: ğŸ”§ Install dependencies and ğŸ”¨ Build Project
              run: |
                  npm install 
                  npm run build

            # - name: List output files
            #   run: find dist/ -print

            - name: ğŸ•µï¸ Verify dist/ contents
              run: |
                  ls -R dist/
                  echo "Total files in dist: $(find dist/ -type f | wc -l)"

            - name: ğŸ“‚ Sync files
              uses: SamKirkland/FTP-Deploy-Action@4.3.3
              with:
                  server: ${{ secrets.SERVER }}
                  username: ${{ secrets.USERNAME }}
                  password: ${{ secrets.PASSWORD }}
                  local-dir: dist/
                  dangerous-clean-slate: true  # XÃ³a file cÅ© trÆ°á»›c khi deploy
                  exclude: |
                      **/.git**
                      **/.git*/**
                      **/node_modules/**
                      **/.**
