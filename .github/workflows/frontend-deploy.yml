name: ğŸš€ Deploy for frontend

on:
    push:
        branches:
            - master
        paths:
            - frontend/**
    pull_request:
        branches:
            - master
        paths:
            - frontend/**

jobs:
    deploy:
        name: ğŸ‰ Deploy
        runs-on: ubuntu-latest
        defaults:
            run:
                working-directory: ./frontend

        steps:
            - name: ğŸšš Get latest code
              uses: actions/checkout@v4

            - name: â” Setup Node
              uses: actions/setup-node@v4
              with:
                  node-version: "20"
                  cache: "npm"

            - name: ğŸ“¦ Cache dependencies
              uses: actions/cache@v4
              with:
                  path: |
                      frontend/node_modules/**
                  key: ${{ runner.os }}-frontend-${{ hashFiles('**/package-lock.json') }}
                  restore-keys: |
                      ${{ runner.os }}-frontend-

            #   - name: ğŸ“ Set environment variables
            #     run: echo "REACT_APP_API_URL=${{ secrets.REACT_APP_API_URL }}" >> .env

            - name: ğŸ”§ Install dependencies and ğŸ”¨ Build Project
              run: |
                  npm ci --prefer-offline
                  npm install 
                  npm run build

            - name: ğŸ•µï¸ Verify dist/ contents
              run: |
                  ls -R frontend/dist/
                  echo "Total files in dist: $(find frontend/dist/ -type f | wc -l)"

            - name: ğŸ“‚ Sync files
              uses: SamKirkland/FTP-Deploy-Action@4.3.3
              with:
                  server: ${{ secrets.SERVER }}
                  username: ${{ secrets.USERNAME }}
                  password: ${{ secrets.PASSWORD }}
                  local-dir: dist/
                  dangerous-clean-slate: true # XÃ³a file cÅ© trÆ°á»›c khi deploy
                  exclude: |
                      **/.git**
                      **/.git*/**
                      **/node_modules/**
                      **/.**
